# App Page Studio

一个用于将设计稿 HTML 转换为 AI 开发提示词的工具，帮助快速还原 Flutter、React Native 和 UniApp 页面。

## ✨ 功能特性

- **HTML 预览** - 在模拟手机框架中实时预览设计稿 HTML，支持多种设备尺寸
- **多平台支持** - 支持 Flutter、React Native、UniApp 三种平台，生成对应的代码提示
- **多状态管理** - 将多个 HTML 文件分组为同一页面的不同状态（默认、加载中、空数据等）
- **开发状态追踪** - 为每个页面标记开发状态（待开发/开发中/已完成），方便进度管理
- **元素选择器** - 类似浏览器 DevTools 的元素选择功能，定义交互行为和图片替换
- **查看样式** - 查看选中元素的详细样式信息（文字、盒模型、背景、布局），支持拖拽面板
- **交互配置** - 为元素添加点击、滑动等交互行为描述
- **图片替换** - 标记需要替换为图片的元素，自动生成图片资源引用提示
- **功能描述** - 为元素添加功能描述（如摄像头、扫码、地图等原生功能）
- **取色器** - 从设计稿中提取颜色，快速构建设计系统
- **设计系统** - 配置颜色、间距、圆角等设计规范
- **智能搜索** - 文件名搜索和开发状态筛选，快速定位页面
- **元素回选** - 点击已配置的交互/图片项，自动在预览中高亮对应元素
- **提示词生成** - 生成结构化的 AI 提示词，支持按开发状态筛选
- **多项目管理** - 支持多个项目快速切换
- **实时热更新** - 文件变更自动刷新预览
- **深色/浅色主题** - 支持主题切换

## 🚀 快速开始

### 安装依赖

```bash
npm install
```

### 启动服务

```bash
# 开发模式（自动打开浏览器）
npm run dev

# 或普通模式
npm start
```

访问 http://localhost:3000

## 📖 使用流程

### 1. 创建/选择项目
- 点击顶部项目选择器
- 创建新项目或选择现有项目
- 上传包含 HTML 设计稿的 ZIP 文件
- 可选配置设计系统 JSON

### 2. 扫描 HTML 文件
- 点击"刷新"按钮扫描 HTML 文件
- 文件列表显示在左侧边栏
- 新文件默认为"待开发"状态

### 3. 搜索和筛选文件
- **搜索框**: 输入文件名或路径快速搜索，支持关键字高亮
- **状态筛选**: 点击"全部/待开发/开发中/已完成"按钮筛选

### 4. 配置页面分组
- 选择多个相关文件（如：默认状态、加载中、空数据）
- 点击"创建分组"
- 填写分组信息：
  - **名称**：如 "首页"
  - **描述**：页面功能说明
  - **路由**：App 中的路由路径（如 `/home`）
  - **源码路径**：各平台对应的源码路径
    - Flutter: `lib/pages/home_page.dart`
    - React Native: `app/home.tsx`
    - UniApp: `pages/home/home.vue`
  - **标记颜色**：分组的视觉标识

### 5. 配置单个文件
- 点击文件进入详情面板
- 填写：
  - **状态名称**：如 "默认状态"、"加载中"
  - **描述**：当前状态的说明
  - **开发状态**：待开发 / 开发中 / 已完成
  - **分组**：选择所属的页面分组

### 6. 配置交互行为
- 点击"选择元素"按钮
- 在预览中点击要配置的元素
- 选择"添加交互"
- 填写交互描述（如："跳转到详情页"）

### 7. 配置图片替换
- 点击"选择元素"按钮
- 在预览中点击要替换的元素
- 选择"替换为图片"
- 填写：
  - **元素选择器**：自动填充
  - **图片路径**：如 `assets/banner.png`
  - **描述**：图片用途说明（可选）

### 8. 配置功能描述
- 点击"选择元素"按钮
- 在预览中点击要配置的元素
- 选择"功能描述"
- 填写功能说明（如："打开摄像头拍摄"、"扫码识别二维码"）

### 9. 配置设计系统
- 点击顶部调色板图标
- 配置颜色、间距、圆角
- 使用取色器从设计稿提取颜色
- 保存设计系统配置

### 10. 生成提示词
- 点击"生成提示词"按钮
- 选择目标平台（Flutter / React Native / UniApp）
- 选择要包含的开发状态（默认选中"开发中"）
- 点击"生成"按钮
- 复制或下载提示词

## 📁 项目结构

```
app-page-studio/
├── server.js              # Express 服务入口
├── db.js                  # SQLite 数据库模块
├── api/                   # API 路由
│   ├── projects.js        # 项目管理
│   ├── pages.js           # 页面配置
│   ├── html.js            # HTML 扫描/分析
│   ├── prompt.js          # 提示词生成
│   └── utils.js           # 共享工具
├── public/                # 前端静态文件
│   ├── index.html         # 主页面
│   ├── css/styles.css     # 样式
│   └── js/
│       ├── icons.js       # SVG 图标组件
│       ├── theme.js       # 主题切换
│       ├── state.js       # 状态管理
│       ├── api.js         # API 封装
│       ├── picker.js      # 元素选择器
│       ├── ui.js          # UI 渲染
│       └── app.js         # 应用入口
├── html_caches/           # 项目 HTML 文件存储
│   └── {project_id}/      # 按项目 ID 分目录
└── data.db                # SQLite 数据库
```

## 🎯 核心功能详解

### 开发状态管理
每个页面文件都有开发状态标记：
- **待开发** (黄色) - 还未开始开发
- **开发中** (蓝色) - 正在开发中
- **已完成** (绿色) - 开发完成

状态用途：
1. 在文件列表中快速识别进度
2. 筛选特定状态的文件
3. 生成提示词时按状态筛选（默认只生成"开发中"的页面）

### 元素选择器
点击"选择元素"后，在预览中：
- **点击元素** → 弹出菜单选择操作
- **添加交互** → 定义点击、滑动等行为
- **替换为图片** → 标记需要替换为图片的区域
- **功能描述** → 添加原生功能说明
- **查看样式** → 显示元素的详细样式信息

### 元素回选高亮
- 点击交互列表或图片替换列表中的**选择器标签**
- 预览区域自动滚动并高亮对应元素
- 高亮效果：绿色边框 + 脉冲动画，3秒后自动消失

### 查看样式
点击元素后选择"查看样式"，可查看：
- **基本信息**：标签名、选择器、文本内容（文本元素）
- **文字样式**（文本元素）：字体、字号、字重、行高、字间距、颜色、对齐、装饰
- **盒模型**：宽高、内外边距、边框、圆角
- **背景与视觉**：背景色、透明度、阴影
- **布局**：display、position、flex 属性、溢出、层级

面板功能：
- 点击颜色值或样式值可复制到剪贴板
- 拖拽标题栏可移动面板位置
- 面板会自动限制在可视区域内

### 取色器
- 点击"取色"按钮激活取色模式
- 在预览中点击任意位置提取颜色
- 提取的颜色可添加到设计系统

### 缩放控制
- 使用滑块或 +/- 按钮调整预览缩放
- 支持 25% - 150% 缩放范围
- 点击重置按钮恢复 100%

### 多平台支持
| 平台 | 语言 | 布局组件 | 状态管理 | 路由 | 图片路径 |
|------|------|----------|----------|------|----------|
| Flutter | Dart | Column, Row, Stack | GetX | GetX 路由 | `Image.asset('assets/images/xxx.png')` |
| React Native | TypeScript | View, ScrollView | Zustand | Expo Router | `require('@/assets/images/xxx.png')` |
| UniApp | Vue 3 + TS | view, scroll-view | Pinia | uni-app 路由 | `'/static/images/xxx.png'` |

### 图片替换说明
在生成的提示词中，图片替换会显示为：
```
- 图片替换:
  - `.banner-img` → 替换为图片 `assets/banner.png` (首页轮播图)
```

AI 会根据提示词：
1. 忽略 HTML 中的原始内容
2. 在指定位置使用图片组件
3. 自动复制图片到项目资源目录

### 功能描述说明
在生成的提示词中，功能描述会显示为：
```
- 功能描述（这些元素并非静态展示，需要实现对应的功能）:
  - `.camera-btn`: 点击打开摄像头拍摄
  - `.scan-area`: 扫码识别二维码
```

## 🔧 技术栈

- **后端**: Node.js + Express + SQLite
- **前端**: 原生 HTML/CSS/JS (无框架依赖)
- **HTML 解析**: Cheerio
- **文件处理**: Multer + ADM-Zip
- **热更新**: WebSocket + Chokidar
- **数据库**: better-sqlite3

## 📝 提示词示例

生成的提示词包含：
1. **目标平台信息** - 框架、语言、组件、状态管理、路由
2. **重要注意事项** - 忽略状态栏、导航栏等
3. **图片资源处理** - 自动检测和引用方式
4. **路由管理指南** - 各平台的路由使用说明
5. **设计系统** - 颜色、间距、圆角配置
6. **页面列表** - 每个页面的详细配置（按开发状态筛选）
7. **交互行为** - 元素的点击、滑动等事件
8. **图片替换** - 需要替换为图片的元素
9. **功能描述** - 需要实现的原生功能
10. **开发指引** - 最佳实践和注意事项

## 💡 使用技巧

1. **开发状态管理**：新开发的页面标记为"开发中"，完成后标记为"已完成"
2. **分组策略**：将同一页面的不同状态（默认、加载、空数据）分到一组
3. **选择器精确**：使用具体的 class 或 id，避免使用通用选择器
4. **描述清晰**：交互和图片替换的描述要具体明确
5. **多平台配置**：如果需要多平台，填写所有平台的源码路径
6. **图片路径**：使用项目资源目录的相对路径
7. **设计系统**：配置好颜色和间距，AI 会使用这些值生成代码
8. **批量操作**：使用搜索和状态筛选快速定位需要处理的页面

## 🐛 常见问题

**Q: 为什么预览不显示？**
A: 请先上传 HTML 文件并选择要预览的文件

**Q: 选择器找不到元素？**
A: 检查选择器语法是否正确，或在浏览器 DevTools 中验证

**Q: 如何修改已创建的分组？**
A: 点击分组名称右侧的编辑按钮

**Q: 提示词中的源码路径显示"待创建"？**
A: 在分组配置中填写对应平台的源码路径

**Q: 生成的提示词没有包含某些页面？**
A: 检查页面的开发状态，确保在生成提示词时勾选了对应的状态筛选

**Q: 如何只生成特定状态的页面提示词？**
A: 在生成提示词弹窗中，勾选需要包含的开发状态（待开发/开发中/已完成）

## 📄 License

MIT
